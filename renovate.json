{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "nix": {
    "enabled": true
  },
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": [
      "before 3am on Monday"
    ],
    "labels": [
      "dependencies",
      "nix-flake"
    ],
    "commitMessagePrefix": "chore(nix): ",
    "commitMessageAction": "update",
    "commitMessageTopic": "flake.lock"
  },
  "packageRules": [
    {
      "description": "GitHub Actions updates",
      "matchManagers": [
        "github-actions"
      ],
      "labels": [
        "dependencies",
        "github-actions"
      ],
      "commitMessagePrefix": "chore(ci): ",
      "commitMessageTopic": "{{depName}}",
      "commitMessageExtra": ": {{currentValue}} -> {{newValue}}",
      "automerge": false
    },
    {
      "description": "Nix flake updates",
      "matchManagers": [
        "nix"
      ],
      "labels": [
        "dependencies",
        "nix-flake"
      ],
      "commitMessagePrefix": "chore(nix): ",
      "commitMessageTopic": "{{depName}}",
      "commitMessageExtra": ": {{currentDigestShort}} -> {{newDigestShort}}",
      "automerge": false
    },
    {
      "description": "For pins: ALWAYS enable digest pinning for all images",
      "matchFileNames": [
        "nix/_dockerfiles/pins/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "pinDigests": true,
      "labels": [
        "dependencies",
        "docker",
        "digest-update"
      ],
      "commitMessagePrefix": "update(docker): ",
      "commitMessageTopic": "digests",
      "commitMessageExtra": ""
    },
    {
      "description": "For pins: Disable all tag updates (major, minor, patch)",
      "matchFileNames": [
        "nix/_dockerfiles/pins/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "matchUpdateTypes": [
        "major",
        "minor",
        "patch"
      ],
      "enabled": false
    },
    {
      "description": "For all in 'versions/': Disable digests completely",
      "matchFileNames": [
        "nix/_dockerfiles/versions/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "pinDigests": false,
      "matchUpdateTypes": [
        "digest",
        "pinDigest"
      ],
      "enabled": false
    },
    {
      "description": "For version tag updates: nixpkgs-style commit messages",
      "matchFileNames": [
        "nix/_dockerfiles/versions/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "matchUpdateTypes": [
        "major",
        "minor",
        "patch"
      ],
      "labels": [
        "dependencies",
        "docker",
        "tag-update"
      ],
      "commitMessagePrefix": "",
      "commitMessageTopic": "{{depName}}",
      "commitMessageExtra": ": {{currentValue}} -> {{newValue}}",
      "semanticCommits": "disabled"
    },
    {
      "description": "For 'major/': Only allow major version updates",
      "matchFileNames": [
        "nix/_dockerfiles/versions/major/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "enabled": false
    },
    {
      "description": "For 'major-minor/': Allow major and minor updates only",
      "matchFileNames": [
        "nix/_dockerfiles/versions/major-minor/**"
      ],
      "matchManagers": [
        "dockerfile"
      ],
      "matchUpdateTypes": [
        "patch"
      ],
      "enabled": false
    }
  ],
  "prConcurrentLimit": 0,
  "prHourlyLimit": 0,
  "prCreation": "immediate",
  "autoApprove": true,
  "automerge": false,
  "configMigration": true,
  "rebaseWhen": "behind-base-branch",
  "recreateWhen": "always"
}
